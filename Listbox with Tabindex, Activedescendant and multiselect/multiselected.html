<!DOCTYPE html>
<html lang="en">
<head>
    <title>listbox</title>
</head>
<style>
    .listbox-item-1[aria-selected="true"] {
        background-color: #ddd;
        border-color: rgb(0, 0, 0);
        border-width: 2px;
        border-style: solid;
        width: 10cm;
    }
    .listbox-item-1 {
        padding: 10px;
    }
    .listbox :focus {
        width: 5cm;
    }
    .main-content :focus{
        width: 10cm;
    }
</style>
<body>
    <div class="multiselected">
        <h2>Listbox with Activedescendant</h2>
        <label for="listbox" id="listbox-label-1"><b>Add User:</b></label><br>
        <div class="main-content">
            <div class="listbox1" role="listbox-1" aria-labelledby="states" aria-activedescendant="">
                <div id="state1" class="listbox-item-1" role="option" aria-selected="false" >Rahul.B</div>
                <div id="state2" class="listbox-item-1" role="option" aria-selected="false" >Anant.P</div>
                <div id="state3" class="listbox-item-1" role="option" aria-selected="false" >Suraj.P</div>
                <div id="state4" class="listbox-item-1" role="option" aria-selected="false" >Madhav.S</div>
                <div id="state5" class="listbox-item-1" role="option" aria-selected="false" >Gaurav.A</div>
                <div id="state6" class="listbox-item-1" role="option" aria-selected="false" >Krushana.K</div>
            </div>
        </div>
    </div>
    <script>
        let Listbox = document.querySelector('.listbox1');
        let Items = Array.from(Listbox.children);
        Listbox.setAttribute('role', 'listbox-1');
        Listbox.setAttribute('tabindex', '0');
        Listbox.setAttribute('aria-labelledby', 'listbox-label');

        Listbox.addEventListener('keydown', e => {
        let currentIndex = Items.findIndex(Item => Item === document.activeElement);

        if (e.key === 'ArrowUp' && currentIndex > 0) {
            e.preventDefault();
            Items[currentIndex - 1].focus();
        }
        if (e.key === 'ArrowDown' && currentIndex < Items.length - 1) {
            e.preventDefault();
            Items[currentIndex + 1].focus();
        }
        if (e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            toggleSelection(document.activeElement);
        }
        });

        Listbox.addEventListener('click', e => {
        let clickedItem = e.target;
        if (clickedItem.classList.contains('listbox-item-1')) {
            toggleSelection(clickedItem);
        }
        });

        function toggleSelection(item) {
        let isSelected = item.getAttribute('aria-selected') === 'true';

        if (isSelected) {
            item.setAttribute('aria-selected', 'false');
        } else {
            item.setAttribute('aria-selected', 'true');
        }
        }
    </script>
</body>
</html>